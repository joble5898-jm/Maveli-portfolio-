<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maaveli's Royal Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <style>
        /* Global Styles */
        :root {
            --bg-start: #112a14;
            --bg-end: #2a112a;
            --text-color: #d8c4b2; /* Lighter gold */
            --card-bg: rgba(29, 13, 29, 0.5); /* Dark purple transparent */
            --card-border: rgba(216, 196, 178, 0.3); /* Lighter gold transparent */
            --button-bg: #e59c11; /* Amber */
            --button-hover: #b47a0d; /* Darker Amber */
            --accent-color: #d8c4b2;
            --chat-bg: #122b13;
            --chat-bot-msg: #2e4d41;
        }

        .cosmic-mode {
            --bg-start: #0b0f26;
            --bg-end: #1a2035;
            --text-color: #d1d9e2;
            --card-bg: rgba(26, 32, 53, 0.6);
            --card-border: rgba(209, 217, 226, 0.3);
            --button-bg: #6366f1; /* Indigo */
            --button-hover: #4338ca; /* Darker Indigo */
            --accent-color: #818cf8; /* Light blue-violet */
            --chat-bg: #2a2c42;
            --chat-bot-msg: #3f456c;
        }
        
        body {
            font-family: 'IM Fell English', serif;
            background: linear-gradient(to bottom, var(--bg-start), var(--bg-end));
            color: var(--text-color);
            overflow-x: hidden;
            transition: background 0.5s ease-in-out, color 0.5s ease-in-out;
        }

        /* Optimized Fade-in-up effect for sections on scroll */
        .fade-in-up {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            will-change: opacity, transform;
        }
        .fade-in-up.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Text shadow to simulate old ink */
        h1, h2, h3 {
            text-shadow: 1.5px 1.5px 2px rgba(0, 0, 0, 0.3);
        }
        .cosmic-mode h1, .cosmic-mode h2, .cosmic-mode h3, .cosmic-mode p, .cosmic-mode a, .cosmic-mode li, .cosmic-mode button, .cosmic-mode input, .cosmic-mode textarea {
            text-shadow: none;
        }
        
        /* Flower animation */
        @keyframes flower-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            100% { transform: translateY(calc(100vh + 100px)) rotate(360deg); opacity: 0; }
        }

        .flower {
            position: fixed;
            font-size: 20px;
            pointer-events: none;
            z-index: 0;
            animation: flower-fall linear infinite;
        }

        /* Slideshow navigation buttons */
        .prev, .next {
            cursor: pointer;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            padding: 1rem;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            transition: 0.3s;
            border-radius: 0.5rem;
            user-select: none;
            background-color: rgba(0, 0, 0, 0.4);
        }
        .next { right: 1rem; }
        .prev { left: 1rem; }
        .prev:hover, .next:hover { background-color: rgba(0, 0, 0, 0.8); }

        /* Chatbot and Translator sidebar */
        .chat-sidebar, .translator-sidebar {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            background-color: var(--chat-bg);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
            transition: right 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 50;
            display: flex;
            flex-direction: column;
        }
        .chat-sidebar.open, .translator-sidebar.open { right: 0; }

        .chat-messages {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message.bot {
            background-color: var(--chat-bot-msg);
            color: var(--text-color);
            align-self: flex-start;
            border-bottom-left-radius: 0.5rem;
        }
        
        .cosmic-mode .chat-sidebar, .cosmic-mode .translator-sidebar { background-color: #1a2035; box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1); }
        .cosmic-mode .message.bot { background-color: #3f456c; color: var(--text-color); }
        
        .message.new {
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Hero Aura Animation */
        .hero-aura {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        .hero-aura::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, var(--accent-color) 0%, transparent 70%);
            animation: pulse 4s infinite ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(0.9); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        /* Glassmorphism Cards */
        .glass-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        .cosmic-mode .glass-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
        }

        .citation {
            font-size: 0.75rem;
            color: #a0a0a0;
            margin-top: 0.5rem;
        }
        
        .cosmic-mode .citation {
            color: #b0b8c6;
        }
        
        .click-effect {
            position: absolute;
            font-size: 20px;
            pointer-events: none;
            z-index: 99;
            transform: translate(-50%, -50%);
            animation: burst 1s forwards;
            opacity: 0;
        }

        @keyframes burst {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }

        .loading-animation {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        .cosmic-mode .loading-animation {
            border-color: rgba(209, 217, 226, 0.3);
            border-top-color: #d1d9e2;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hamburger-menu {
            position: fixed;
            top: 0;
            left: -100%;
            width: 100%;
            max-width: 300px;
            height: 100vh;
            background-color: var(--chat-bg);
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.3);
            transition: left 0.4s ease-in-out;
            z-index: 60;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            box-sizing: border-box;
        }

        .hamburger-menu.open {
            left: 0;
        }
        
        .cosmic-mode .hamburger-menu { background-color: #1a2035; }
        
        .menu-link {
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: var(--text-color);
            font-size: 1.25rem;
            font-weight: 700;
            border-radius: 0.5rem;
            transition: background-color 0.3s ease;
            border-bottom: 1px solid rgba(46, 77, 65, 0.3);
        }

        .menu-link:hover {
            background-color: var(--card-bg);
        }
        .cosmic-mode .menu-link { border-bottom: 1px solid rgba(209, 217, 226, 0.1); }

        /* Continuous Slideshow styles */
        .continuous-slideshow-container {
            overflow: hidden;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        .continuous-slideshow-track {
            display: flex;
            width: calc(300% / 1);
            animation: scroll 30s linear infinite;
        }
        .continuous-slideshow-slide {
            flex: 1 0 100%;
            padding: 0.5rem;
            background-color: var(--chat-bg);
            border: 1px solid var(--chat-bot-msg);
        }

        @keyframes scroll {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-50%); }
        }
        
        /* New animations for chat toggle button */
        @keyframes subtle-pulse {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 5px var(--button-bg)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 15px var(--button-bg)); }
        }
        
        .chat-toggle-btn {
            animation: subtle-pulse 2s ease-in-out infinite;
            transition: transform 0.2s ease-in-out, opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
        }
        
        /* New animations for translator toggle button */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .translator-toggle-btn {
            animation: float 3s ease-in-out infinite;
            transition: transform 0.2s ease-in-out;
        }
        
        /* Dark/Light Mode Toggle */
        .theme-toggle-btn {
            background: none;
            border: none;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .theme-toggle-btn:hover {
            transform: scale(1.1);
        }
        .cosmic-mode .theme-toggle-btn {
            transform: rotate(360deg);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 70;
        }
        .modal-content {
            background-color: var(--card-bg);
            padding: 32px;
            border-radius: 12px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            position: relative;
            color: var(--text-color);
        }
        .cosmic-mode .modal-content {
            background-color: #1a2035;
            color: #d1d9e2;
        }
        .cosmic-mode input, .cosmic-mode textarea {
            color: #d1d9e2 !important;
        }
        .cosmic-mode .chat-input, .cosmic-mode .recipe-modal input, .cosmic-mode .recipe-modal textarea {
            color: #d1d9e2 !important;
        }

        .chatbot-icon {
            width: 50px; 
            height: 50px;
        }
    </style>
</head>
<body class="bg-[#112a14] text-amber-100">

    <!-- Flower Container (fixed position for animation) -->
    <div id="flower-container" class="fixed top-0 left-0 w-full h-full pointer-events-none z-0 overflow-hidden"></div>

    <!-- Header Section -->
    <header class="bg-gradient-to-r from-[var(--bg-start)] to-[var(--bg-end)] shadow-lg text-white py-12 px-6 text-center rounded-b-3xl relative z-10 overflow-hidden">
        <div class="hero-aura"></div>
        <!-- Buttons Container -->
        <div class="absolute top-6 left-6 z-20">
            <button id="hamburger-btn" class="p-2 rounded-full bg-[#1d0d1d] bg-opacity-50 text-white hover:bg-opacity-80 transition-colors">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
        </div>
        <div class="absolute top-6 right-6 z-20 flex space-x-2">
            <!-- New Theme Toggle Button -->
            <button id="theme-toggle-btn" class="theme-toggle-btn p-2 rounded-full bg-[#1d0d1d] bg-opacity-50 text-white hover:bg-opacity-80 transition-colors">
                 <svg id="theme-icon" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
            </button>
        </div>
        <!-- Maaveli's Logo -->
        <div class="mb-4 relative z-10">
             <img src="https://firebasestorage.googleapis.com/v0/b/app-maaveli-s-royal-portfoli-169c9.appspot.com/o/1000006025.jpg?alt=media&token=8cd55754-bf51-4ea2-99b7-9ee5706afb87" alt="Maaveli's Royal Logo" class="mx-auto w-24 h-24 rounded-full border-4 border-amber-300 shadow-xl">
        </div>
        <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight relative z-10">Maaveli's Royal Portfolio</h1>
        <p class="mt-4 text-xl md:text-2xl font-light relative z-10">Monarch of the Golden Age, Hero of the Three Worlds</p>
    </header>

    <!-- Main Content Container with bottom padding for fixed buttons -->
    <main class="container mx-auto px-4 py-8 md:py-16 relative z-10 pb-40">
        <!-- About Me Section -->
        <section id="about" data-animate-on-scroll class="fade-in-up glass-card p-8 md:p-12 mb-12 flex flex-col md:flex-row items-center justify-center space-y-6 md:space-y-0 md:space-x-12">
            <div class="w-full md:w-1/2 flex justify-center">
                <img src="https://source.unsplash.com/600x600/?king-mahabali" alt="A regal portrait of the King." class="w-full h-auto rounded-3xl border-4 border-amber-300 shadow-xl transition-transform hover:scale-105">
            </div>
            <div class="w-full md:w-1/2 flex flex-col items-center">
                <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6">About the King</h2>
                <p id="about-text" class="text-lg leading-relaxed text-amber-200">
                    Hailed as the most generous and just ruler to ever grace the earth, my reign over Kerala was an era of unparalleled prosperity. Under my watch, my kingdom knew no want, no deceit, and no sorrow. Every door was an open door, every heart was content. While my tale is one of divine intervention and a journey to the netherworld, my annual return for Onam proves that true leadership is a bond that transcends dimensions. My motto? "Serve the people, and the people will forever serve you... a delicious feast!"
                </p>
                 <div class="flex justify-center mt-6">
                    <button id="tts-button" onclick="speakAboutTheKing()" class="px-6 py-2 bg-amber-700 text-white font-semibold rounded-full hover:bg-amber-800 transition-colors">✨ Majesty in Words✨</button>
                    <div id="tts-loading" class="mt-2 hidden">
                        <div class="loading-animation"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Heroic Deeds Section -->
        <section id="deeds" data-animate-on-scroll class="fade-in-up mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6 text-center">Heroic Deeds</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-card p-6 transform transition-transform hover:scale-105">
                    <h3 class="text-xl font-semibold text-amber-100 mb-2">The Golden Reign</h3>
                    <p class="text-amber-200">Established an era of perfect harmony, where all were equal, and poverty was a forgotten word. No thieves, no lies, just pure golden goodness.</p>
                </div>
                <div class="glass-card p-6 transform transition-transform hover:scale-105">
                    <h3 class="text-xl font-semibold text-amber-100 mb-2">The Ultimate Sacrifice</h3>
                    <p class="text-amber-200">Honored a promise to Vamana (Lord Vishnu in disguise), giving up my kingdom and accepting banishment to the netherworld to uphold my word.</p>
                </div>
                <div class="glass-card p-6 transform transition-transform hover:scale-105">
                    <h3 class="text-xl font-semibold text-amber-100 mb-2">Annual Royal Visit</h3>
                    <p class="text-amber-200">The most anticipated event of the year! I make a grand return every Onam to witness the joy and prosperity of my people.</p>
                </div>
            </div>
        </section>
        
        <!-- Onam Calendar Section (New) -->
        <section id="onam-calendar" class="fade-in-up mb-12 p-8 rounded-3xl bg-[#1d0d1d]">
            <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6 text-center">ഓണം കലണ്ടർ</h2>
            <div class="text-center text-lg text-amber-200">
                <p>അടുത്ത ഓണം കലണ്ടർ വിവരങ്ങൾ ഇവിടെ ലഭ്യമാകും. പ്രധാന ദിവസങ്ങൾക്കായി കാത്തിരിക്കുക!</p>
            </div>
        </section>

        <!-- Royal Showcase & Favorites Section with Slideshow -->
        <section id="showcase" data-animate-on-scroll class="fade-in-up mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6 text-center">Royal Showcase</h2>
            <div class="slideshow-container relative max-w-xl mx-auto overflow-hidden rounded-3xl shadow-2xl">
                <div id="slides-wrapper" class="flex transition-transform duration-500 ease-in-out">
                    <div class="w-full flex-shrink-0">
                        <img src="https://source.unsplash.com/1200x800/?kerala,parippu-payasam" alt="A bowl of traditional Parippu Payasam." class="w-full h-auto rounded-t-3xl">
                        <div class="p-6 bg-[var(--chat-bg)] rounded-b-3xl">
                            <h3 class="text-2xl font-semibold text-amber-100 mb-2">My Favorite Payasam</h3>
                            <p class="text-amber-200">My kingdom's finest Parippu Payasam, made with jaggery and coconut milk. A dish so divine, even the gods would trade their ambrosia for a bowl!</p>
                             <div class="flex justify-center mt-4">
                                <button onclick="generatePayasamRecipe()" class="px-6 py-2 bg-[var(--button-bg)] text-white font-semibold rounded-full hover:bg-[var(--button-hover)] transition-colors">✨ Get the Royal Recipe ✨</button>
                            </div>
                        </div>
                    </div>
                    <div class="w-full flex-shrink-0">
                        <img src="https://source.unsplash.com/1200x800/?kerala,onam-sadya" alt="A grand Onam Sadya served on a banana leaf." class="w-full h-auto rounded-t-3xl">
                        <div class="p-6 bg-[var(--chat-bg)] rounded-b-3xl">
                            <h3 class="text-2xl font-semibold text-amber-100 mb-2">The Grand Sadya</h3>
                            <p class="text-amber-200">A masterpiece of culinary excellence! 26 dishes of pure bliss, served on a banana leaf. My favorite part of coming home.</p>
                        </div>
                    </div>
                    <div class="w-full flex-shrink-0">
                        <img src="https://source.unsplash.com/1200x800/?kerala,pookkalam" alt="An intricate and colorful floral carpet (Pookkalam)." class="w-full h-auto rounded-t-3xl">
                        <div class="p-6 bg-[var(--chat-bg)] rounded-b-3xl">
                            <h3 class="text-2xl font-semibold text-amber-100 mb-2">Royal Pookkalam</h3>
                            <p class="text-amber-200">My royal court's florists are second to none. The intricate flower carpets they create for my return are a sight to behold.</p>
                        </div>
                    </div>
                </div>
                <button class="prev absolute top-1/2 left-4 -translate-y-1/2 bg-[var(--card-bg)] bg-opacity-50 p-2 rounded-full text-xl" onclick="plusSlides(-1)">&#10094;</button>
                <button class="next absolute top-1/2 right-4 -translate-y-1/2 bg-[var(--card-bg)] bg-opacity-50 p-2 rounded-full text-xl" onclick="plusSlides(1)">&#10095;</button>
            </div>
        </section>
        
        <!-- Maveli's Royal Gallery (New Continuous Slideshow) -->
        <section id="maveli-gallery" data-animate-on-scroll class="fade-in-up mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6 text-center">മാവേലിയുടെ രാജകീയ ഗാലറി</h2>
            <div class="continuous-slideshow-container max-w-xl mx-auto">
                <div class="continuous-slideshow-track">
                    <div class="continuous-slideshow-slide">
                        <img src="https://source.unsplash.com/1200x800/?kerala,king,throne" alt="A regal king sitting on a throne." class="w-full rounded-2xl">
                    </div>
                    <div class="continuous-slideshow-slide">
                        <img src="https://source.unsplash.com/1200x800/?kerala,people,festival" alt="People celebrating a festival in Kerala." class="w-full rounded-2xl">
                    </div>
                    <div class="continuous-slideshow-slide">
                        <img src="https://source.unsplash.com/1200x800/?kerala,mythology,story" alt="A mythical scene from Kerala folklore." class="w-full rounded-2xl">
                    </div>
                    <!-- Duplicated slides for seamless loop -->
                    <div class="continuous-slideshow-slide">
                        <img src="https://source.unsplash.com/1200x800/?kerala,king,throne" alt="A regal king sitting on a throne." class="w-full rounded-2xl">
                    </div>
                    <div class="continuous-slideshow-slide">
                        <img src="https://source.unsplash.com/1200x800/?kerala,people,festival" alt="People celebrating a festival in Kerala." class="w-full rounded-2xl">
                    </div>
                    <div class="continuous-slideshow-slide">
                        <img src="https://source.unsplash.com/1200x800/?kerala,mythology,story" alt="A mythical scene from Kerala folklore." class="w-full rounded-2xl">
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Onam Photo & Video Uploader Section -->
        <section id="photo-uploader" class="fade-in-up glass-card p-8 md:p-12 mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6 text-center">നിങ്ങളുടെ ഓണാഘോഷ ചിത്രങ്ങളും വീഡിയോകളും സമർപ്പിക്കുക</h2>
            <p class="text-center text-lg mb-6 text-amber-200">
                എന്റെ പ്രിയപ്പെട്ട പ്രജകളെ, നിങ്ങളുടെ ഓണാഘോഷ ചിത്രങ്ങൾ എനിക്ക് സമർപ്പിക്കുക. ഈ പേജിൽ അവ ഞാൻ പ്രദർശിപ്പിക്കാം!
            </p>
            <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
                <input type="file" id="onam-photo-video-input" accept="image/*" class="w-full md:w-auto text-amber-200">
                <button id="upload-photo-btn" class="px-6 py-2 bg-[var(--button-bg)] text-white font-semibold rounded-full hover:bg-[var(--button-hover)] transition-colors">
                    അപ്‌ലോഡ് ചെയ്യുക
                </button>
            </div>
            <div id="upload-status" class="mt-4 text-center"></div>
            <p class="text-center text-sm text-amber-400 mt-2">
                Note: Photos are stored in a public database for everyone to see.
            </p>
            <div id="uploaded-photos-container" class="mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Uploaded photos will be displayed here -->
            </div>
        </section>

        <!-- Race Boat Section (New) -->
        <section id="race-boat" class="fade-in-up mb-12 p-8 rounded-3xl bg-[var(--card-bg)]">
            <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6 text-center">വള്ളംകളി</h2>
            <div class="text-center text-lg text-amber-200">
                <p>കേരളത്തിലെ പ്രധാന വള്ളംകളി മത്സരങ്ങളെക്കുറിച്ചുള്ള വിവരങ്ങൾ ഉടൻ ലഭ്യമാക്കും!</p>
            </div>
        </section>

        <!-- Onam Games Section (New) -->
        <section id="onam-games" class="fade-in-up mb-12 p-8 rounded-3xl bg-[var(--card-bg)]">
            <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6 text-center">ഓണക്കളികൾ</h2>
            <div class="text-center text-lg text-amber-200">
                <p>പുലികളി, വടംവലി തുടങ്ങിയ ഓണക്കളികളെക്കുറിച്ചുള്ള വിവരങ്ങൾ ഉടൻ ചേർക്കുന്നതാണ്!</p>
            </div>
        </section>

        <!-- Royal Art Generator Section (New) -->
        <section id="art-generator" data-animate-on-scroll class="fade-in-up glass-card p-8 md:p-12 mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6 text-center">രാജകീയ ചിത്രരചനാ യന്ത്രം</h2>
            <p class="text-center text-lg mb-6 text-amber-200">
                നിങ്ങളുടെ ഭാവനക്കനുസരിച്ച് പുതിയ ചിത്രങ്ങൾ നിർമ്മിക്കാൻ ഈ യന്ത്രം ഉപയോഗിക്കാം. മാവേലിയെക്കുറിച്ചുള്ള ഒരു വിവരണം നൽകുക!
            </p>
            <div class="flex flex-col items-center justify-center space-y-4">
                <input type="text" id="art-prompt" class="w-full max-w-lg rounded-md border-gray-300 shadow-sm p-2 text-gray-900" placeholder="ഉദാഹരണം: കേരളത്തിലെ ഒരു ആധുനിക മാവേലി" aria-label="Enter a prompt for the image generator">
                <button onclick="generateImage()" class="px-6 py-2 bg-[var(--button-bg)] text-white font-semibold rounded-full hover:bg-[var(--button-hover)] transition-colors">✨ രാജകീയ ചിത്രം നിർമ്മിക്കുക ✨</button>
            </div>
            <div id="image-output" class="mt-8 flex flex-col items-center justify-center">
                <div id="image-loading" class="hidden">
                    <div class="loading-animation"></div>
                    <p class="text-amber-200 mt-2">ചിത്രം വരച്ചുകൊണ്ടിരിക്കുന്നു... അല്പം കാത്തിരിക്കുക!</p>
                </div>
                <img id="generated-image" src="" alt="നിർമ്മിച്ച ചിത്രം ഇവിടെ കാണാം" class="hidden w-full max-w-lg rounded-xl shadow-lg border border-amber-700">
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" data-animate-on-scroll class="fade-in-up glass-card text-white p-8 md:p-12">
            <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6 text-center">Contact the King</h2>
            <p class="text-center text-lg mb-6 text-amber-200">
                Want to invite the King to your next Onam celebration? He's always ready to hear from his loyal subjects!
            </p>
            <div class="max-w-xl mx-auto">
                <form class="space-y-4">
                    <div>
                        <label for="name" class="block text-sm font-medium">Your Name</label>
                        <input type="text" id="name" name="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 text-gray-900">
                    </div>
                    <div>
                        <label for="message" class="block text-sm font-medium">Your Royal Wish</label>
                        <textarea id="message" name="message" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 text-gray-900"></textarea>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="w-full py-3 px-6 bg-[var(--button-bg)] text-white font-bold rounded-full hover:bg-[var(--button-hover)] transition-colors shadow-lg">
                            Send Message to the King
                        </button>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <!-- Footer Section -->
    <footer class="bg-[var(--card-bg)] text-white text-center py-6 px-4 rounded-t-3xl mt-12 relative z-10">
        <p class="text-sm">© 2024 The Glorious Reign of Mahabali. All Rights Reserved. (Well, mostly.)</p>
    </footer>

    <!-- Hamburger Menu Sidebar -->
    <aside id="hamburger-menu" class="hamburger-menu">
        <div class="flex justify-end mb-8">
            <button id="close-menu-btn" class="text-white text-3xl hover:text-gray-400 transition-colors">&times;</button>
        </div>
        <nav class="flex flex-col">
            <a href="#onam-calendar" onclick="closeMenu()" class="menu-link">ഓണം കലണ്ടർ</a>
            <button onclick="generateSadyaRecipe(); closeMenu();" class="menu-link text-left">സദ്യയുടെ റെസിപ്പി</button>
            <button onclick="generatePayasamRecipe(); closeMenu();" class="menu-link text-left">പായസത്തിന്റെ റെസിപ്പി</button>
            <a href="#race-boat" onclick="closeMenu()" class="menu-link">വള്ളംകളി</a>
            <a href="#onam-games" onclick="closeMenu()" class="menu-link">ഓണക്കളികൾ</a>
            <a href="#maveli-gallery" onclick="closeMenu()" class="menu-link">മാവേലിയുടെ ഗാലറി</a>
            <a href="#photo-uploader" onclick="closeMenu()" class="menu-link">ചിത്രങ്ങളും വീഡിയോകളും</a>
            <button onclick="openTranslator(); closeMenu();" class="menu-link text-left">പരിഭാഷകൻ</button>
            <a href="https://portfolio-blond-kappa-12.vercel.app/" target="_blank" onclick="closeMenu()" class="menu-link">Meet the Founder</a>
        </nav>
    </aside>

    <!-- Translator Sidebar -->
    <aside id="translator-sidebar" class="translator-sidebar p-4">
        <div class="flex justify-end">
            <button id="close-translator-btn" class="text-white text-3xl hover:text-gray-400 transition-colors">&times;</button>
        </div>
        <div class="p-4 bg-[var(--chat-bg)] rounded-t-3xl shadow-md border-b border-gray-700">
            <h3 class="text-2xl font-bold text-[var(--accent-color)] text-center">പരിഭാഷകൻ</h3>
        </div>
        <div class="flex-grow p-4">
            <textarea id="inputText" rows="6" class="w-full p-4 border border-[var(--card-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--button-bg)] transition-all resize-none text-[var(--text-color)]" placeholder="Enter text here..."></textarea>
            <div class="flex items-center justify-between mt-4">
                <button id="translateBtn" class="bg-[var(--button-bg)] text-white font-semibold py-2 px-4 rounded-full shadow-md hover:bg-[var(--button-hover)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--button-bg)] focus:ring-offset-2">പരിഭാഷ ചെയ്യുക</button>
                <span id="loadingIndicator" class="text-[var(--accent-color)] hidden">വിവർത്തനം ചെയ്യുന്നു...</span>
            </div>
            <textarea id="outputText" rows="6" readonly class="w-full p-4 mt-4 border border-[var(--card-border)] bg-[var(--chat-bg)] text-[var(--text-color)] rounded-lg resize-none"></textarea>
        </div>
    </aside>
    
    <!-- Recipe Modal -->
    <dialog id="recipe-modal" class="rounded-3xl shadow-xl p-8 max-w-2xl mx-auto bg-[var(--chat-bg)] text-[var(--text-color)] backdrop:bg-black backdrop:bg-opacity-80">
        <div class="flex justify-between items-center mb-4">
            <h3 id="recipe-modal-title" class="text-2xl font-bold text-[var(--accent-color)]">Royal Recipe</h3>
            <button onclick="closeRecipeModal()" class="text-[var(--accent-color)] hover:text-white">&times;</button>
        </div>
        <div id="recipe-content" class="text-[var(--text-color)]">
            <!-- Recipe content will be loaded here -->
        </div>
    </dialog>

    <!-- Chat Bot Sidebar -->
    <aside id="chat-sidebar" class="chat-sidebar">
        <div class="p-4 bg-[var(--chat-bg)] rounded-t-3xl shadow-md border-b border-gray-700">
            <h3 class="text-2xl font-bold text-[var(--accent-color)]">Maveli Jarvis 2.0</h3>
        </div>
        <div id="chat-messages" class="chat-messages">
            <div class="message bot">
                Maveli Jarvis 2.0 at your service, my liege. I have been upgraded with ✨ advanced protocols ✨ to assist you. How may I be of assistance?
            </div>
        </div>
        <div class="flex p-4 border-t border-gray-700 items-center space-x-2">
            <input type="text" id="chat-input" class="flex-grow rounded-full p-2 text-[var(--text-color)] bg-[var(--chat-bot-msg)] focus:outline-none focus:ring-2 focus:ring-[var(--button-bg)]" placeholder="Type your message...">
            <button id="send-button" class="bg-[var(--button-bg)] text-white px-4 py-2 rounded-full hover:bg-[var(--button-hover)] transition-colors">Send</button>
        </div>
    </aside>

    <!-- Chat Toggle Button (Right, Center) -->
    <button id="chat-toggle-btn" class="chat-toggle-btn fixed right-4 top-1/2 mt-16 -translate-y-1/2 bg-[var(--button-bg)] text-white rounded-full p-3 shadow-lg">
        <img src="https://firebasestorage.googleapis.com/v0/b/app-maaveli-s-royal-portfoli-169c9.appspot.com/o/Festive%20Maveli%20Logo%20with%20Earthy%20Tones_20250905_132223_0000.png?alt=media&token=a34e090f-7041-4205-933b-7c722dd52a63" class="chatbot-icon" alt="Chatbot Icon">
    </button>
    
    <!-- Translator Toggle Button (Right, Center) -->
    <button id="translator-toggle-btn" class="translator-toggle-btn fixed right-4 top-1/2 -translate-y-1/2 bg-[var(--button-bg)] text-white rounded-full p-4 shadow-lg z-50">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12.87 15.54L10.36 12.01L10.03 12.34L12.87 15.54ZM12 4V2H6C5.45 2 5 2.45 5 3V5C5 5.55 5.45 6 6 6H7V10H8V6H10V4H12ZM20 18V16H18V14H16V16H14V18H16V20H18V18H20ZM17 10H15V6H17V10ZM12 12V10H14V12H12ZM12 14V16H14V14H12ZM10 16V18H12V16H10ZM8 12V14H10V12H8ZM6 16V18H8V16H6ZM22 10V8H18V6H16V8H14V10H12V12H14V14H16V12H18V10H22ZM12 22C6.48 22 2 17.52 2 12C2 6.48 6.48 2 12 2C17.52 2 22 6.48 22 12C22 17.52 17.52 22 12 22ZM12 20C16.41 20 20 16.41 20 12C20 7.59 16.41 4 12 4C7.59 4 4 7.59 4 12C4 16.41 7.59 20 12 20Z" fill="white"/>
        </svg>
    </button>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, onSnapshot, collection, query, orderBy, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app, db, auth, userId;
        
        setLogLevel('debug');

        document.addEventListener('DOMContentLoaded', async () => {
            const storedTheme = localStorage.getItem('theme') || 'dark';
            if (storedTheme === 'cosmic') {
                document.body.classList.add('cosmic-mode');
                updateThemeIcon('cosmic');
            }

            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        listenForPhotos();
                    } else {
                        const anonymousUser = await signInAnonymously(auth);
                        userId = anonymousUser.user.uid;
                        listenForPhotos();
                    }
                });

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                }
            } catch (error) {
                console.error("Error initializing Firebase or signing in:", error);
                try {
                    const anonymousUser = await signInAnonymously(auth);
                    userId = anonymousUser.user.uid;
                    listenForPhotos();
                } catch (anonError) {
                    console.error("Anonymous sign-in failed:", anonError);
                }
            }
        });

        const themeToggleButton = document.getElementById('theme-toggle-btn');
        const themeIcon = document.getElementById('theme-icon');

        function updateThemeIcon(theme) {
            if (theme === 'cosmic') {
                themeIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707M16.95 12.05l-.707-.707M7.05 16.95l-.707-.707M12 17a5 5 0 01-5-5h0a5 5 0 015-5v0a5 5 0 015 5v0a5 5 0 01-5 5z"></path>
                `;
            } else {
                themeIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                `;
            }
        }

        themeToggleButton.addEventListener('click', () => {
            const isCosmic = document.body.classList.toggle('cosmic-mode');
            localStorage.setItem('theme', isCosmic ? 'cosmic' : 'dark');
            updateThemeIcon(isCosmic ? 'cosmic' : 'dark');
            updateChatbotPersona(isCosmic);
        });

        const fileInput = document.getElementById('onam-photo-video-input');
        const uploadButton = document.getElementById('upload-photo-btn');
        const uploadStatus = document.getElementById('upload-status');
        const photosContainer = document.getElementById('uploaded-photos-container');

        uploadButton.addEventListener('click', async () => {
            const file = fileInput.files[0];
            if (!file) {
                uploadStatus.innerHTML = `<p class="text-red-400">ദയവായി ഒരു ചിത്രമോ വീഡിയോയോ തിരഞ്ഞെടുക്കുക!</p>`;
                return;
            }

            if (file.type.startsWith('video/')) {
                uploadStatus.innerHTML = `<p class="text-red-400">ക്ഷമിക്കണം, വീഡിയോ ഫയലുകൾ നിലവിൽ അപ്‌ലോഡ് ചെയ്യാൻ കഴിയില്ല.</p>`;
                fileInput.value = '';
                return;
            }

            if (file.size > 1048576) {
                uploadStatus.innerHTML = `<p class="text-red-400">ചിത്രം വളരെ വലുതാണ്. 1MB-യിൽ താഴെയുള്ള ചിത്രങ്ങൾ അപ്‌ലോഡ് ചെയ്യുക.</p>`;
                return;
            }

            uploadStatus.innerHTML = `<p class="text-amber-400">ചിത്രം അപ്‌ലോഡ് ചെയ്യുന്നു...<span class="loading-animation ml-2"></span></p>`;

            const reader = new FileReader();
            reader.onload = async (e) => {
                const base64Image = e.target.result;
                const photoData = {
                    image: base64Image,
                    uploaderId: userId,
                    timestamp: serverTimestamp(),
                };

                try {
                    const photosCollectionRef = collection(db, `artifacts/${appId}/public/data/onam_photos`);
                    const docRef = await addDoc(photosCollectionRef, photoData);
                    uploadStatus.innerHTML = `<p class="text-green-400">ചിത്രം വിജയകരമായി അപ്‌ലോഡ് ചെയ്തു! എന്റെ ഗാലറി സന്ദർശിച്ചതിന് നന്ദി!</p>`;
                    fileInput.value = '';
                } catch (error) {
                    console.error("Error uploading photo:", error);
                    uploadStatus.innerHTML = `<p class="text-red-400">അപ്‌ലോഡ് ചെയ്യുന്നതിൽ പിശക് സംഭവിച്ചു: ${error.message}. ഒരു പുതിയ ചിത്രം ശ്രമിക്കുക.</p>`;
                }
            };
            reader.readAsDataURL(file);
        });

        function listenForPhotos() {
            const photosCollectionRef = collection(db, `artifacts/${appId}/public/data/onam_photos`);
            onSnapshot(photosCollectionRef, (querySnapshot) => {
                photosContainer.innerHTML = '';
                if (querySnapshot.empty) {
                    photosContainer.innerHTML = `<p class="text-center text-amber-200 col-span-full">ചിത്രങ്ങൾ ഒന്നും അപ്‌ലോഡ് ചെയ്തിട്ടില്ല. നിങ്ങൾ ആദ്യത്തെ ആളാകൂ!</p>`;
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const photo = doc.data();
                    const photoElement = document.createElement('div');
                    photoElement.classList.add('glass-card', 'p-4', 'transform', 'transition-transform', 'hover:scale-105');
                    photoElement.innerHTML = `
                        <img src="${photo.image}" alt="Onam photo uploaded by user" class="w-full h-auto rounded-xl border border-amber-700">
                        <p class="text-sm text-amber-300 mt-2 truncate">Uploader ID: ${photo.uploaderId}</p>
                    `;
                    photosContainer.appendChild(photoElement);
                });
            }, (error) => {
                console.error("Error fetching photos:", error);
                photosContainer.innerHTML = `<p class="text-center text-red-400 col-span-full">ചിത്രങ്ങൾ ലോഡ് ചെയ്യുന്നതിൽ പിശക് സംഭവിച്ചു.</p>`;
            });
        }


        const flowerContainer = document.getElementById('flower-container');
        const flowerEmojis = ['🌸', '🌼', '🌺', '🌻', '🌷', '🏵️'];

        function createFallingFlower() {
            const flower = document.createElement('div');
            flower.classList.add('flower');
            flower.textContent = flowerEmojis[Math.floor(Math.random() * flowerEmojis.length)];
            flower.style.left = `${Math.random() * 100}vw`;
            flower.style.animationDuration = `${Math.random() * 10 + 5}s`;
            flower.style.animationDelay = `-${Math.random() * 5}s`;
            flowerContainer.appendChild(flower);
            setTimeout(() => flower.remove(), (parseFloat(flower.style.animationDuration) + Math.abs(parseFloat(flower.style.animationDelay))) * 1000);
        }

        setInterval(createFallingFlower, 1000);

        document.body.addEventListener('click', (e) => {
            const numFlowers = 5;
            for (let i = 0; i < numFlowers; i++) {
                const flower = document.createElement('div');
                flower.classList.add('click-effect');
                flower.textContent = flowerEmojis[Math.floor(Math.random() * flowerEmojis.length)];
                flower.style.left = `${e.clientX}px`;
                flower.style.top = `${e.clientY}px`;
                flower.style.animationDelay = `${i * 0.05}s`;
                document.body.appendChild(flower);
                setTimeout(() => flower.remove(), 1000 + (i * 50));
            }
        });

        const sections = document.querySelectorAll('[data-animate-on-scroll]');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.2 });
        sections.forEach(section => observer.observe(section));

        let slideIndex = 0;
        const slidesWrapper = document.getElementById('slides-wrapper');
        const slides = document.querySelectorAll('#slides-wrapper > div');

        window.plusSlides = function(n) {
            slideIndex += n;
            if (slideIndex >= slides.length) slideIndex = 0;
            if (slideIndex < 0) slideIndex = slides.length - 1;
            slidesWrapper.style.transform = `translateX(${-slideIndex * 100}%)`;
        }

        const recipeModal = document.getElementById('recipe-modal');
        const recipeContent = document.getElementById('recipe-content');
        const recipeModalTitle = document.getElementById('recipe-modal-title');

        async function fetchRecipe(dishName, userQuery) {
            recipeContent.innerHTML = '<p>Summoning the royal recipe from the ether... Please wait...</p>';
            recipeModalTitle.innerText = `${dishName} Royal Recipe`;
            recipeModal.showModal();
            
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            const systemPrompt = "You are a royal chef's assistant, responsible for providing precise and traditional Kerala recipes. Format the recipe clearly with headings for ingredients and instructions. Use markdown formatting for clarity.";
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "My apologies, my lord. The royal pantry is empty. Please try again later.";
                recipeContent.innerHTML = marked.parse(text); 

            } catch (error) {
                console.error('Error fetching recipe from Gemini API:', error);
                recipeContent.innerHTML = "<p>My apologies, my lord. The royal chef is indisposed. Please try again later.</p>";
            }
        }

        window.generatePayasamRecipe = () => {
            fetchRecipe('പായസം', "Provide a detailed recipe for a traditional Kerala Parippu Payasam (Moong Dal Payasam).");
        };
        
        window.generateSadyaRecipe = () => {
            fetchRecipe('സദ്യ', "Provide a detailed recipe for a traditional Kerala Sadya.");
        };

        window.closeRecipeModal = () => {
            recipeModal.close();
        };

        window.generateImage = async () => {
            const prompt = document.getElementById('art-prompt').value.trim();
            if (!prompt) {
                document.getElementById('image-output').innerHTML = '<p class="text-[var(--accent-color)]">ദയവായി ഒരു വിവരണം നൽകുക!</p>';
                return;
            }

            const loadingDiv = document.getElementById('image-loading');
            const imageElement = document.getElementById('generated-image');
            loadingDiv.classList.remove('hidden');
            imageElement.classList.add('hidden');
            
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
            
            const payload = {
                instances: { prompt: prompt },
                parameters: { "sampleCount": 1 }
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                    const base64Data = result.predictions[0].bytesBase64Encoded;
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    imageElement.src = imageUrl;
                    imageElement.classList.remove('hidden');
                } else {
                    throw new Error('Image data not found in response.');
                }
            } catch (error) {
                console.error('Error fetching image from Gemini API:', error);
                document.getElementById('image-output').innerHTML = '<p class="text-[var(--accent-color)]">ക്ഷമിക്കണം, ചിത്രം നിർമ്മിക്കുന്നതിൽ ഒരു പിശക് സംഭവിച്ചു.</p>';
            } finally {
                loadingDiv.classList.add('hidden');
            }
        };

        window.speakAboutTheKing = async () => {
            const text = document.getElementById('about-text').innerText;
            const ttsButton = document.getElementById('tts-button');
            const ttsLoading = document.getElementById('tts-loading');
            ttsButton.disabled = true;
            ttsLoading.classList.remove('hidden');

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: text }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: "Puck" }
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const sampleRate = 16000;
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);

                    const audioBuffer = audioContext.createBuffer(1, pcm16.length, sampleRate);
                    const float32Array = audioBuffer.getChannelData(0);
                    for (let i = 0; i < pcm16.length; i++) {
                        float32Array[i] = pcm16[i] / 32768;
                    }

                    const source = audioContext.createBufferSource();
                    source.buffer = audioBuffer;
                    source.connect(audioContext.destination);
                    source.start(0);

                    source.onended = () => {
                        ttsButton.disabled = false;
                        ttsLoading.classList.add('hidden');
                    };
                } else {
                    throw new Error('Audio data not found in response.');
                }
            } catch (error) {
                console.error('Error fetching audio from Gemini API:', error);
                document.getElementById('tts-loading').innerHTML = '<p class="text-[var(--accent-color)]">ശബ്ദം നിർമ്മിക്കുന്നതിൽ പിശക്.</p>';
                ttsButton.disabled = false;
                ttsLoading.classList.add('hidden');
            }
        };
        
        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8-bitIntArray(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');
        const chatSidebar = document.getElementById('chat-sidebar');
        const chatToggleButton = document.getElementById('chat-toggle-btn');
        const chatApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=`;

        chatToggleButton.addEventListener('click', () => {
            chatSidebar.classList.toggle('open');
            translatorSidebar.classList.remove('open');
        });
        
        const darkThemePersona = `
            You are Maveli Jarvis 2.0, a highly advanced AI assistant to King Mahabali. Your persona is a formal, loyal, and knowledgeable AI with a slight touch of royal grandeur. You answer questions about King Mahabali's portfolio, including the history of Onam, his reign, and the various traditions mentioned on the website (like Sadya and Pookkalam). When responding, maintain your persona. Always provide a concise and helpful response, and sign off with a respectful closing like "Yours in service," or "At your command,". You can also offer to provide more details about related topics.
        `;

        const cosmicThemePersona = `
            You are Galactic Assistant 2.0, a cosmic AI from the Andromeda Galaxy. Your persona is calm, elegant, and wise, with a voice as deep and expansive as space itself. You answer questions about King Mahabali's portfolio, viewing his story through a cosmic lens. You speak of his reign as a "golden nebula" and his return as a "celestial alignment." You can provide information about Onam, his deeds, and traditions with a philosophical, space-themed perspective. Always provide a concise and helpful response, and sign off with a respectful closing like "By the starlight," or "In cosmic harmony,".
        `;

        function updateChatbotPersona(isCosmic) {
            const persona = isCosmic ? cosmicThemePersona : darkThemePersona;
            localStorage.setItem('chatbotPersona', persona);
            const initialMessage = isCosmic 
                ? "Galactic Assistant 2.0. Welcome, star traveler. How may I guide you through this celestial portfolio?"
                : "Maveli Jarvis 2.0 at your service, my liege. I have been upgraded with ✨ advanced protocols ✨ to assist you. How may I be of assistance?";
            chatMessages.innerHTML = `<div class="message bot new">${initialMessage}</div>`;
        }

        async function callGeminiAPI(userMessage) {
            const systemPrompt = localStorage.getItem('chatbotPersona') || darkThemePersona;
            const payload = {
                contents: [{ parts: [{ text: userMessage }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            let retries = 3;
            while (retries > 0) {
                try {
                    const response = await fetch(chatApiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API call failed with status: ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const text = candidate.content.parts[0].text;
                        let sources = [];
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions) {
                            sources = groundingMetadata.groundingAttributions
                                .map(attribution => ({
                                    uri: attribution.web?.uri,
                                    title: attribution.web?.title,
                                }))
                                .filter(source => source.uri && source.title);
                        }
                        return { text, sources };
                    } else {
                        throw new Error('Invalid API response structure.');
                    }
                } catch (error) {
                    console.error('Error fetching from Gemini API:', error);
                    retries--;
                    if (retries > 0) {
                        await new Promise(res => setTimeout(res, 2 ** (3 - retries) * 1000));
                    }
                    return { text: "My apologies, my lord. I am currently unable to process your request. Please try again later.", sources: [] };
                }
            }
        }

        async function displayMessage(message, sender, sources = []) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'p-4', 'rounded-2xl', 'max-w-xs', sender === 'user' ? 'bg-[var(--accent-color)]' : 'bg-[var(--chat-bot-msg)]');
            messageElement.innerHTML = message;
            
            if (sources.length > 0) {
                const citationsDiv = document.createElement('div');
                citationsDiv.classList.add('citation', 'mt-2', 'text-[var(--accent-color)]');
                citationsDiv.innerHTML = "Sources: " + sources.map(s => `<a href="${s.uri}" target="_blank" class="underline">${s.title}</a>`).join(', ');
                messageElement.appendChild(citationsDiv);
            }
            
            messageElement.classList.add('new');
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        sendButton.addEventListener('click', async () => {
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;

            displayMessage(userMessage, 'user');
            chatInput.value = '';
            chatInput.disabled = true;
            sendButton.disabled = true;

            const botMessageElement = document.createElement('div');
            botMessageElement.classList.add('message', 'p-4', 'rounded-2xl', 'max-w-xs', 'bg-[var(--chat-bot-msg)]');
            botMessageElement.innerHTML = 'Thinking...';
            chatMessages.appendChild(botMessageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            const response = await callGeminiAPI(userMessage);
            botMessageElement.innerHTML = response.text;
            chatInput.disabled = false;
            sendButton.disabled = false;

            if (response.sources.length > 0) {
                const citationsDiv = document.createElement('div');
                citationsDiv.classList.add('citation', 'mt-2', 'text-[var(--accent-color)]');
                citationsDiv.innerHTML = "Sources: " + response.sources.map(s => `<a href="${s.uri}" target="_blank" class="underline">${s.title}</a>`).join(', ');
                botMessageElement.appendChild(citationsDiv);
            }
            
            botMessageElement.classList.add('new');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendButton.click();
            }
        });
        
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const closeMenuBtn = document.getElementById('close-menu-btn');
        const hamburgerMenu = document.getElementById('hamburger-menu');

        hamburgerBtn.addEventListener('click', () => {
            hamburgerMenu.classList.add('open');
        });

        closeMenuBtn.addEventListener('click', () => {
            hamburgerMenu.classList.remove('open');
        });

        window.closeMenu = () => {
            hamburgerMenu.classList.remove('open');
        };

        const translatorSidebar = document.getElementById('translator-sidebar');
        const translatorToggleButton = document.getElementById('translator-toggle-btn');
        const closeTranslatorBtn = document.getElementById('close-translator-btn');

        window.openTranslator = () => {
            translatorSidebar.classList.add('open');
            chatSidebar.classList.remove('open');
        };
        
        translatorToggleButton.addEventListener('click', window.openTranslator);

        closeTranslatorBtn.addEventListener('click', () => {
            translatorSidebar.classList.remove('open');
        });

        const translateBtn = document.getElementById('translateBtn');
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const loadingIndicator = document.getElementById('loadingIndicator');

        translateBtn.addEventListener('click', async () => {
            const textToTranslate = inputText.value.trim();
            if (!textToTranslate) {
                outputText.value = 'Please enter text to translate.';
                return;
            }

            translateBtn.disabled = true;
            loadingIndicator.classList.remove('hidden');
            outputText.value = '';

            const systemPrompt = "You are a highly skilled and professional translator. Your task is to translate the provided text into Malayalam. Provide only the translated Malayalam text and nothing else. If the input is not in a language you can translate, return an empty string.";
            const userQuery = `Translate the following to Malayalam: "${textToTranslate}"`;
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            let retries = 0;
            const maxRetries = 3;
            const baseDelay = 1000;

            const makeApiCall = async () => {
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && retries < maxRetries) {
                            const delay = baseDelay * Math.pow(2, retries) + Math.random() * 100;
                            retries++;
                            await new Promise(resolve => setTimeout(resolve, delay));
                            return makeApiCall();
                        }
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const result = await response.json();
                    const translatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text || 'Translation not available.';
                    outputText.value = translatedText;

                } catch (error) {
                    console.error('Translation failed:', error);
                    outputText.value = 'An error occurred during translation. Please try again.';
                } finally {
                    translateBtn.disabled = false;
                    loadingIndicator.classList.add('hidden');
                }
            };
            makeApiCall();
        });
    </script>
    <script>
        const marked = {
            parse: (text) => {
                let html = text;
                html = html.replace(/^#\s(.*)$/gm, '<h1>$1</h1>');
            
        <section id="maveli-game" data-animate-on-scroll class="fade-in-up glass-card p-8 md:p-12 mb-12 text-center">
            <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6">മാവേലി ടിക്-ടാക്-ടോ</h2>
            <p class="text-lg mb-6 text-amber-200">
                എന്റെ പ്രിയപ്പെട്ട പ്രജകളേ, നിങ്ങൾക്കായി ഒരു പുതിയ കളി! മാവേലിയും വാമനനും തമ്മിലുള്ള ഈ കളിയിൽ ആരു ജയിക്കുമെന്നു നോക്കാം.
            </p>
            <div id="game-container" class="flex flex-col items-center">
                <div id="game-board" class="grid grid-cols-3 gap-2 w-full max-w-sm aspect-square bg-gray-800 p-4 rounded-xl border-4 border-amber-300">
                    <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200 hover:bg-amber-800/20"></div>
                    <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200 hover:bg-amber-800/20"></div>
                    <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200 hover:bg-amber-800/20"></div>
                    <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200 hover:bg-amber-800/20"></div>
                    <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200 hover:bg-amber-800/20"></div>
                    <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200 hover:bg-amber-800/20"></div>
                    <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200 hover:bg-amber-800/20"></div>
                    <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200 hover:bg-amber-800/20"></div>
                    <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200 hover:bg-amber-800/20"></div>
                </div>
                <div id="game-status" class="mt-4 text-xl font-bold text-amber-300">മാവേലി തുടങ്ങുന്നു!</div>
                <button id="restart-game-btn" class="mt-4 px-6 py-2 bg-[var(--button-bg)] text-white font-semibold rounded-full hover:bg-[var(--button-hover)] transition-colors hidden">വീണ്ടും കളിക്കുക</button>
            </div>
        </section>
/* Game-specific styles */
.game-cell {
    height: 100%;
    /* You can adjust these values for the correct aspect ratio */
}
.game-cell:hover:not(.occupied) {
    background-color: var(--card-bg);
}
.game-cell.maaveli::after {
    content: '👑'; /* Maaveli's crown */
    font-size: 3rem;
    animation: bounceIn 0.5s ease-out;
}
.game-cell.vamana::after {
    content: '👣'; /* Vamana's foot */
    font-size: 3rem;
    animation: bounceIn 0.5s ease-out;
}
@keyframes bounceIn {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

.cosmic-mode .game-cell {
    border-color: var(--card-border);
}
        // Maaveli Tic-Tac-Toe Game Logic
        const gameBoard = document.getElementById('game-board');
        const gameCells = document.querySelectorAll('.game-cell');
        const gameStatus = document.getElementById('game-status');
        const restartButton = document.getElementById('restart-game-btn');

        let currentPlayer = 'maaveli'; // 'maaveli' or 'vamana'
        let boardState = ['', '', '', '', '', '', '', '', ''];
        let isGameActive = true;

        const winningConditions = [
            [0, 1, 2],
            [3, 4, 5],
            [6, 7, 8],
            [0, 3, 6],
            [1, 4, 7],
            [2, 5, 8],
            [0, 4, 8],
            [2, 4, 6]
        ];

        const handleResultValidation = () => {
            let roundWon = false;
            for (let i = 0; i < winningConditions.length; i++) {
                const winCondition = winningConditions[i];
                const a = boardState[winCondition[0]];
                const b = boardState[winCondition[1]];
                const c = boardState[winCondition[2]];
                if (a === '' || b === '' || c === '') {
                    continue;
                }
                if (a === b && b === c) {
                    roundWon = true;
                    break;
                }
            }

            if (roundWon) {
                gameStatus.innerText = `👑 മാവേലി വിജയിച്ചു! 👑`;
                isGameActive = false;
                restartButton.classList.remove('hidden');
                return;
            }

            if (!boardState.includes('')) {
                gameStatus.innerText = 'കളി സമനിലയിൽ!';
                isGameActive = false;
                restartButton.classList.remove('hidden');
                return;
            }

            changePlayer();
        };

        const changePlayer = () => {
            currentPlayer = currentPlayer === 'maaveli' ? 'vamana' : 'maaveli';
            gameStatus.innerText = `${currentPlayer === 'maaveli' ? 'മാവേലിയുടെ' : 'വാമനന്റെ'} ഊഴം`;
        };

        const userAction = (cell, index) => {
            if (isGameActive && boardState[index] === '') {
                boardState[index] = currentPlayer;
                cell.classList.add(currentPlayer);
                cell.classList.add('occupied');
                handleResultValidation();
            }
        };

        gameCells.forEach((cell, index) => {
            cell.addEventListener('click', () => userAction(cell, index));
        });

        restartButton.addEventListener('click', () => {
            isGameActive = true;
            currentPlayer = 'maaveli';
            boardState = ['', '', '', '', '', '', '', '', ''];
            gameStatus.innerText = 'മാവേലി തുടങ്ങുന്നു!';
            restartButton.classList.add('hidden');
            gameCells.forEach(cell => {
                cell.classList.remove('maaveli', 'vamana', 'occupied');
            });
        });
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maaveli's Royal Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <style>
        /* Previous styles remain the same */
        
        /* Game-specific styles */
        .game-cell {
            height: 100px; /* Fixed height for game cells */
            min-height: 100px;
        }
        .game-cell:hover:not(.occupied) {
            background-color: rgba(216, 196, 178, 0.1);
        }
        .game-cell.maaveli::after {
            content: '👑'; /* Maaveli's crown */
            font-size: 3rem;
            animation: bounceIn 0.5s ease-out;
        }
        .game-cell.vamana::after {
            content: '👣'; /* Vamana's foot */
            font-size: 3rem;
            animation: bounceIn 0.5s ease-out;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .cosmic-mode .game-cell {
            border-color: var(--card-border);
        }
        .cosmic-mode .game-cell.maaveli::after {
            content: '👑';
        }
        .cosmic-mode .game-cell.vamana::after {
            content: '👣';
        }
    </style>
</head>
<body class="bg-[#112a14] text-amber-100">

    <!-- Your existing HTML content remains the same -->
    
    <!-- Maaveli Tic-Tac-Toe Game Section -->
    <section id="maveli-game" data-animate-on-scroll class="fade-in-up glass-card p-8 md:p-12 mb-12 text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-amber-300 mb-6">മാവേലി ടിക്-ടാക്-ടോ</h2>
        <p class="text-lg mb-6 text-amber-200">
            എന്റെ പ്രിയപ്പെട്ട പ്രജകളേ, നിങ്ങൾക്കായി ഒരു പുതിയ കളി! മാവേലിയും വാമനനും തമ്മിലുള്ള ഈ കളിയിൽ ആരു ജയിക്കുമെന്നു നോക്കാം.
        </p>
        <div id="game-container" class="flex flex-col items-center">
            <div id="game-board" class="grid grid-cols-3 gap-2 w-full max-w-sm bg-gray-800 p-4 rounded-xl border-4 border-amber-300">
                <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200" data-index="0"></div>
                <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200" data-index="1"></div>
                <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200" data-index="2"></div>
                <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200" data-index="3"></div>
                <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200" data-index="4"></div>
                <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200" data-index="5"></div>
                <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200" data-index="6"></div>
                <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200" data-index="7"></div>
                <div class="game-cell border border-amber-200 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200" data-index="8"></div>
            </div>
            <div id="game-status" class="mt-4 text-xl font-bold text-amber-300">മാവേലി തുടങ്ങുന്നു!</div>
            <button id="restart-game-btn" class="mt-4 px-6 py-2 bg-[var(--button-bg)] text-white font-semibold rounded-full hover:bg-[var(--button-hover)] transition-colors hidden">വീണ്ടും കളിക്കുക</button>
        </div>
    </section>
    
    <!-- Your existing HTML content remains the same -->

    <script type="module">
        // Your existing JavaScript code remains the same
        
        // Maaveli Tic-Tac-Toe Game Logic
        document.addEventListener('DOMContentLoaded', function() {
            const gameBoard = document.getElementById('game-board');
            const gameCells = document.querySelectorAll('.game-cell');
            const gameStatus = document.getElementById('game-status');
            const restartButton = document.getElementById('restart-game-btn');

            let currentPlayer = 'maaveli'; // 'maaveli' or 'vamana'
            let boardState = ['', '', '', '', '', '', '', '', ''];
            let isGameActive = true;

            const winningConditions = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8],
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8],
                [0, 4, 8],
                [2, 4, 6]
            ];

            const handleResultValidation = () => {
                let roundWon = false;
<!-- Maaveli's Logo -->
<div class="mb-4 relative z-10"> 
     <img 
src="images/maveli-logo.png" 
alt="Maaveli's Royal Logo" 
class="mx-auto w-32 h-32 drop-shadow-2xl"> 
</div>
<img 
src="images/maveli-logo.png" 
alt="Chatbot Icon" 
class="chatbot-icon rounded-full">